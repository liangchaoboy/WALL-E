# ç™¾åº¦åœ°å›¾ URL ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼š"ä» Claude è¾“å…¥ 'ä»åŒ—äº¬åˆ°ä¸Šæµ·'ï¼Œæµè§ˆå™¨ä¼šè·³è½¬åˆ°é”™è¯¯çš„é¡µé¢"

**ç—‡çŠ¶ï¼š**
- æµè§ˆå™¨æ‰“å¼€çš„åˆå§‹ URL ä¼šè‡ªåŠ¨è·³è½¬åˆ° `https://map.baidu.com/@12968049,4834747,13z`
- æ— æ³•æ˜¾ç¤ºè·¯çº¿è§„åˆ’ç»“æœ

## æ ¹æœ¬åŸå› 

ç™¾åº¦åœ°å›¾çš„è·¯çº¿è§„åˆ’ API éœ€è¦ `region`ï¼ˆæœç´¢åŒºåŸŸï¼‰å‚æ•°ï¼Œå¦åˆ™æ— æ³•æ­£ç¡®å¤„ç†åœ°åæŸ¥è¯¢ã€‚

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹å†…å®¹

**æ–‡ä»¶ï¼š** [`pkg/mapprovider/provider.go`](file:///Users/sanmu/eva/qwall2/pkg/mapprovider/provider.go)

1. **æ·»åŠ  `region` å‚æ•°**ï¼šä»ç»ˆç‚¹åœ°å€ä¸­æå–åŸå¸‚åç§°
2. **æ–°å¢ `extractCityName` å‡½æ•°**ï¼šæ™ºèƒ½æå–åœ°å€ä¸­çš„åŸå¸‚åç§°

### URL å¯¹æ¯”

**ä¿®å¤å‰ï¼ˆç¼ºå°‘ regionï¼‰ï¼š**
```
http://api.map.baidu.com/direction?destination=ä¸Šæµ·&mode=transit&origin=åŒ—äº¬&output=html&src=webapp.qwall2.navigation
```

**ä¿®å¤åï¼ˆåŒ…å« regionï¼‰ï¼š**
```
http://api.map.baidu.com/direction?destination=ä¸Šæµ·&mode=transit&origin=åŒ—äº¬&output=html&region=ä¸Šæµ·&src=webapp.qwall2.navigation
```

## åº”ç”¨æ›´æ–°

### ç¬¬ 1 æ­¥ï¼šç¡®è®¤ç¼–è¯‘æ—¶é—´

```bash
ls -lh /Users/sanmu/eva/qwall2/qwall2-mcp
```

åº”è¯¥çœ‹åˆ°æœ€æ–°çš„ç¼–è¯‘æ—¶é—´ï¼ˆåˆšæ‰ç¼–è¯‘çš„ï¼‰ã€‚

### ç¬¬ 2 æ­¥ï¼šé‡å¯ Claude Desktop

**é‡è¦ï¼šå¿…é¡»å®Œå…¨é€€å‡º Claude Desktopï¼**

1. ç‚¹å‡»èœå•æ çš„ Claude å›¾æ ‡
2. é€‰æ‹© "Quit Claude"ï¼ˆæˆ–æŒ‰ `Cmd + Q`ï¼‰
3. ç¡®ä¿ Claude å®Œå…¨é€€å‡ºï¼ˆä¸æ˜¯æœ€å°åŒ–ï¼‰
4. é‡æ–°æ‰“å¼€ Claude Desktop

### ç¬¬ 3 æ­¥ï¼šæµ‹è¯•å¯¼èˆª

åœ¨ Claude Desktop ä¸­è¾“å…¥ï¼š

```
ä»åŒ—äº¬åˆ°ä¸Šæµ·
```

**é¢„æœŸç»“æœï¼š**
- âœ… æµè§ˆå™¨æ‰“å¼€ç™¾åº¦åœ°å›¾
- âœ… æ˜¾ç¤ºä»åŒ—äº¬åˆ°ä¸Šæµ·çš„å…¬äº¤è·¯çº¿è§„åˆ’
- âœ… ä¸å†è·³è½¬åˆ°é”™è¯¯é¡µé¢

## æŠ€æœ¯ç»†èŠ‚

### extractCityName å‡½æ•°

è¿™ä¸ªå‡½æ•°è´Ÿè´£ä»åœ°å€ä¸­æ™ºèƒ½æå–åŸå¸‚åç§°ï¼š

```go
func extractCityName(address string) string {
    // 1. æ£€æŸ¥æ˜¯å¦ä»¥å¸¸è§åŸå¸‚åå¼€å¤´
    cities := []string{
        "åŒ—äº¬", "ä¸Šæµ·", "å¤©æ´¥", "é‡åº†",
        "å¹¿å·", "æ·±åœ³", "æ­å·", "æˆéƒ½", "è¥¿å®‰", "å—äº¬",
        // ... æ›´å¤šåŸå¸‚
    }
    
    for _, city := range cities {
        if strings.HasPrefix(address, city) {
            return city  // è¿”å›åŒ¹é…çš„åŸå¸‚å
        }
    }
    
    // 2. å¦‚æœåœ°å€å¾ˆçŸ­ï¼ˆâ‰¤12å­—èŠ‚ï¼‰ï¼Œå¯èƒ½æœ¬èº«å°±æ˜¯åŸå¸‚å
    if len(address) <= 12 {
        return address
    }
    
    // 3. é»˜è®¤è¿”å›"å…¨å›½"
    return "å…¨å›½"
}
```

### æµ‹è¯•ç¤ºä¾‹

| è¾“å…¥åœ°å€ | æå–çš„åŸå¸‚ | è¯´æ˜ |
|---------|-----------|------|
| åŒ—äº¬ | åŒ—äº¬ | ç›´æ¥åŒ¹é… |
| ä¸Šæµ·ä¸œæ–¹æ˜ç  | ä¸Šæµ· | å‰ç¼€åŒ¹é… |
| æ·±åœ³å—å±±åŒº | æ·±åœ³ | å‰ç¼€åŒ¹é… |
| å°åŸå¸‚ | å°åŸå¸‚ | çŸ­åœ°å€ï¼Œç›´æ¥è¿”å› |
| æŸä¸ªä¸çŸ¥åçš„åœ°æ–¹ | å…¨å›½ | é•¿åœ°å€ä¸”æ— åŒ¹é…ï¼Œè¿”å›å…¨å›½ |

## æµ‹è¯•ç»“æœ

æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼š

```
âœ… TestGenerateBaiduMapURL - PASS
âœ… TestGenerateAmapURL - PASS
âœ… TestGenerateNavigationURL - PASS
âœ… TestGetMapProviderName - PASS
âœ… TestIsValidMapProvider - PASS
âœ… TestExtractCityName - PASS (7 ä¸ªæµ‹è¯•ç”¨ä¾‹)
```

## URL å‚æ•°è¯´æ˜

æ ¹æ®[ç™¾åº¦åœ°å›¾å®˜æ–¹æ–‡æ¡£](https://lbsyun.baidu.com/index.php?title=æ¨¡æ¿:uriapiçš„webç«¯)ï¼š

| å‚æ•° | å¿…éœ€ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|------|------|------|--------|
| `origin` | âœ… | èµ·ç‚¹ï¼ˆæ”¯æŒåœ°åæˆ–åæ ‡ï¼‰ | åŒ—äº¬ |
| `destination` | âœ… | ç»ˆç‚¹ï¼ˆæ”¯æŒåœ°åæˆ–åæ ‡ï¼‰ | ä¸Šæµ· |
| `mode` | âœ… | è·¯çº¿æ¨¡å¼ | transit (å…¬äº¤) |
| `region` | âœ… | æœç´¢åŒºåŸŸï¼ˆåŸå¸‚åï¼‰ | ä¸Šæµ· |
| `output` | âœ… | è¾“å‡ºæ ¼å¼ | html |
| `src` | âœ… | åº”ç”¨æ ‡è¯† | webapp.qwall2.navigation |

**å…³é”®å‘ç°ï¼š** `region` å‚æ•°è™½ç„¶åœ¨æ–‡æ¡£ä¸­æ ‡è®°ä¸º"å¯é€‰"ï¼Œä½†å®é™…ä¸Šå¯¹äºåœ°åæŸ¥è¯¢æ˜¯**å¿…éœ€çš„**ï¼Œå¦åˆ™ä¼šå¯¼è‡´è·³è½¬é”™è¯¯ã€‚

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šä»ç„¶è·³è½¬åˆ°é”™è¯¯é¡µé¢

**å¯èƒ½åŸå›  1ï¼š** Claude Desktop æ²¡æœ‰å®Œå…¨é‡å¯

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥æ˜¯å¦æœ‰ Claude è¿›ç¨‹ä»åœ¨è¿è¡Œ
ps aux | grep -i claude | grep -v grep

# å¦‚æœæœ‰è¿›ç¨‹ï¼Œæ‰‹åŠ¨ç»“æŸ
killall Claude

# é‡æ–°å¯åŠ¨ Claude Desktop
open -a Claude
```

**å¯èƒ½åŸå›  2ï¼š** ä½¿ç”¨äº†æ—§ç‰ˆæœ¬çš„ç¨‹åº

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ç¼–è¯‘æ—¶é—´
ls -lh /Users/sanmu/eva/qwall2/qwall2-mcp

# å¦‚æœä¸æ˜¯æœ€æ–°çš„ï¼Œé‡æ–°ç¼–è¯‘
cd /Users/sanmu/eva/qwall2
make build

# é‡å¯ Claude Desktop
```

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°è·¯çº¿

è¿™å¯èƒ½æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºï¼š
- æŸäº›å°åŸå¸‚ä¹‹é—´å¯èƒ½æ²¡æœ‰å…¬äº¤è·¯çº¿
- å¯ä»¥å°è¯•åˆ‡æ¢åˆ°é«˜å¾·åœ°å›¾

åœ¨ Claude ä¸­è¯´ï¼š
```
ä½¿ç”¨é«˜å¾·åœ°å›¾ä»åŒ—äº¬åˆ°ä¸Šæµ·
```

## å®Œæˆ

**ç°åœ¨ç™¾åº¦åœ°å›¾å¯¼èˆªåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œäº†ï¼** ğŸ‰

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ‚¨åœ¨ Claude ä¸­è¾“å…¥çš„å®Œæ•´æŒ‡ä»¤
2. æµè§ˆå™¨æ‰“å¼€çš„å®Œæ•´ URL
3. æµè§ˆå™¨æœ€ç»ˆè·³è½¬åˆ°çš„ URL

---

**æ›´æ–°æ—¶é—´ï¼š** 2025-10-24  
**ä¿®å¤ç‰ˆæœ¬ï¼š** v1.1  
**ç›¸å…³æ–‡ä»¶ï¼š**
- [`pkg/mapprovider/provider.go`](file:///Users/sanmu/eva/qwall2/pkg/mapprovider/provider.go)
- [`pkg/mapprovider/provider_test.go`](file:///Users/sanmu/eva/qwall2/pkg/mapprovider/provider_test.go)
