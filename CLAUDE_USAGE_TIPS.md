# Claude 不使用 MCP 工具时的解决方案

## 🤔 问题现象

有时候在 Claude Desktop 中说"从北京到上海"，Claude 只是回答文字，而不会调用地图工具。

## 🔍 原因分析

### 1. 指令不够明确
Claude 可能认为你只是在询问路线信息，而不是要实际打开地图导航。

### 2. 工具描述不清晰
如果工具的描述不够明确，Claude 不知道什么时候该使用。

### 3. MCP 服务未连接
Claude Desktop 可能没有正确加载 MCP 服务器。

## ✅ 解决方案

### 方案 1：使用更明确的指令（推荐）⭐

**❌ 不太有效的说法：**
```
北京到上海怎么走？
去上海的路线
从北京怎么去上海？
```
Claude 可能认为这是咨询问题，只回答文字。

**✅ 更有效的说法：**
```
从北京到上海
帮我导航到上海
打开地图从北京到上海
我要去上海（从北京出发）
使用百度地图从北京到上海
```

**🌟 最有效的说法（命令式）：**
```
导航：北京 → 上海
地图导航从北京到上海
打开百度地图，从北京到上海
```

### 方案 2：明确提及"打开地图"或"导航"

在指令中加入动作词：
- ✅ "**打开**地图从北京到上海"
- ✅ "**导航**到上海"
- ✅ "**启动**地图导航"
- ✅ "**使用**百度地图从北京到上海"

### 方案 3：直接要求使用工具

如果 Claude 还是不用工具，可以明确说：

```
请使用 navigate_map 工具从北京到上海
```

或者：

```
用你的地图工具帮我从北京到上海
```

### 方案 4：检查 MCP 连接状态

#### 步骤 1：验证 MCP 服务是否运行

```bash
/Users/sanmu/eva/qwall2/check_version.sh
```

**期望输出：**
```
2️⃣  当前运行的进程：
   进程 PID: 84277 启动时间: 3:02下午
```

如果显示"❌ 没有运行中的 qwall2-mcp 进程"，说明：
- Claude Desktop 未启动
- 或 MCP 配置有问题

#### 步骤 2：检查配置文件

```bash
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

**正确的配置：**
```json
{
  "mcpServers": {
    "map-navigation": {
      "command": "/Users/sanmu/eva/qwall2/qwall2-mcp"
    }
  }
}
```

#### 步骤 3：查看 Claude Desktop 日志

**macOS 日志位置：**
```bash
# 查看 MCP 相关日志
tail -f ~/Library/Logs/Claude/mcp*.log
```

如果看到错误信息，说明 MCP 服务启动失败。

### 方案 5：重启 Claude Desktop

有时候 Claude Desktop 需要重启才能正确识别工具：

```bash
/Users/sanmu/eva/qwall2/restart_claude.sh
```

或手动：
1. 完全退出 Claude（`Cmd + Q`）
2. 重新打开 Claude Desktop
3. 等待几秒让 MCP 服务初始化

### 方案 6：在对话开始时提醒 Claude

在新对话的第一条消息中说：

```
你好！我注意到你有地图导航工具。
我可能会需要你帮我打开地图导航，请主动使用你的工具。
```

这会让 Claude 意识到你期望它使用工具。

## 📊 指令有效性对比

| 指令类型 | 示例 | Claude 使用工具概率 |
|---------|------|-------------------|
| 疑问句 | "北京到上海怎么走？" | ⭐ 低（20%） |
| 陈述句 | "我想知道从北京到上海的路线" | ⭐⭐ 中等（40%） |
| 祈使句 | "从北京到上海" | ⭐⭐⭐ 高（70%） |
| 命令式 | "打开地图从北京到上海" | ⭐⭐⭐⭐ 很高（90%） |
| 明确工具 | "使用百度地图从北京到上海" | ⭐⭐⭐⭐⭐ 极高（95%+） |

## 🎯 最佳实践

### 国内路线导航

**推荐说法：**
```
从北京到上海
打开百度地图，从杭州到苏州
帮我导航到深圳（从广州出发）
```

### 国际路线导航

**推荐说法：**
```
使用 Google Maps 从南京到东京
打开谷歌地图，从北京到纽约
Google Maps 导航：上海 → 首尔
```

### 只有终点的情况

如果只说终点，Claude 会询问起点：

**你说：**
```
去杭州西湖
```

**Claude 会问：**
```
好的，我可以帮你打开地图导航到杭州西湖。
请问你的起点在哪里？
```

**你回答：**
```
从上海出发
```

然后 Claude 就会打开地图。

## 🔧 高级技巧

### 技巧 1：使用系统提示词

如果你是 Claude Team/Pro 用户，可以设置自定义指令：

```
当我说"从A到B"、"去某地"、"导航到"等包含地点的指令时，
请主动使用 navigate_map 工具打开地图，而不是只回答文字。
```

### 技巧 2：建立对话习惯

在对话中明确你的期望：

```
以后我说地点导航时，请直接帮我打开地图，
不需要先解释路线再问我要不要打开。
```

Claude 会在当前对话中记住这个偏好。

### 技巧 3：使用缩写或代号

建立你和 Claude 之间的"暗号"：

```
你：以后我说"MAP: A -> B"就代表要用地图从A导航到B
Claude：好的，我记住了！

你：MAP: 北京 -> 上海
Claude：（直接调用工具打开地图）
```

## 🐛 故障排除

### 问题 1：Claude 说"我无法访问地图"

**可能原因：**
- MCP 服务未启动
- 配置文件路径错误

**解决方法：**
```bash
# 1. 检查进程
/Users/sanmu/eva/qwall2/check_version.sh

# 2. 检查配置
cat ~/Library/Application\ Support/Claude/claude_desktop_config.json

# 3. 重启 Claude
/Users/sanmu/eva/qwall2/restart_claude.sh
```

### 问题 2：Claude 使用了工具但打开错误的地图

**可能原因：**
- 没有明确指定地图服务
- 国际路线用了国内地图

**解决方法：**
```
# 明确指定地图
使用百度地图从北京到上海  ✅
使用 Google Maps 从南京到东京  ✅
```

### 问题 3：Claude 总是先问起点终点

**原因：**
这是正常行为，Claude 想确认信息准确。

**解决方法：**
一次性提供完整信息：
```
从北京天安门到上海东方明珠，使用百度地图  ✅
```

## 📝 测试示例

重启 Claude Desktop 后，试试这些指令：

### 测试 1：基本国内导航
```
从北京到上海
```
**期望**：打开百度地图 ✅

### 测试 2：指定地图
```
使用高德地图从杭州到苏州
```
**期望**：打开高德地图 ✅

### 测试 3：国际路线
```
使用 Google Maps 从南京到东京
```
**期望**：打开 Google Maps ✅

### 测试 4：只有终点
```
导航到杭州西湖
```
**期望**：Claude 询问起点，然后打开地图 ✅

### 测试 5：命令式
```
打开地图，从广州到深圳
```
**期望**：直接打开地图 ✅

## 💡 总结

**让 Claude 使用工具的关键：**

1. ✅ **使用命令式语气**："从A到B"、"打开地图"、"导航到"
2. ✅ **明确意图**：说清楚你要"打开地图"而不是"了解路线"
3. ✅ **提供完整信息**：起点和终点都说清楚
4. ✅ **指定地图服务**：特别是国际路线一定要说"Google Maps"
5. ✅ **确保 MCP 连接**：定期检查服务状态

**记住这句话：**
> "打开地图从北京到上海" 比 "北京到上海怎么走？" 更有效！

---

**现在试试吧！重启 Claude Desktop，然后说："从北京到上海"** 🚀
